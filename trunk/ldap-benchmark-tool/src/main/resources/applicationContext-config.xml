<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:p="http://www.springframework.org/schema/p"
	xmlns:aop="http://www.springframework.org/schema/aop" xmlns:tx="http://www.springframework.org/schema/tx"
	xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
	http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop-3.0.xsd
	http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx-3.0.xsd">
  
  <bean id="propertyPlaceholderConfigurer"
    class="com.ibm.lbs.ldap.SpringPropertyPlaceholderConfigurer">
    <!-- 系统属性总是优先, 即: JVM "-Dkey=value"方式设置的属性信息总是优先于在配置文件的设置. -->
    <property name="systemPropertiesModeName" value="SYSTEM_PROPERTIES_MODE_OVERRIDE" />
    <property name="ignoreResourceNotFound" value="true"></property>

    <property name="locations">
      <list>
        <value>classpath:config.properties</value>
        <value>file:${user.home.dir}/config.properties</value>
      </list>
    </property>
  </bean>
  
  <bean name="propertiesHolder" class="com.ibm.lbs.ldap.SpringPropertiesHolder">
    <constructor-arg>
      <ref bean="propertyPlaceholderConfigurer" />
    </constructor-arg>
  </bean>
  
  <bean id="ldapContextSource" class="org.springframework.ldap.core.support.LdapContextSource">
    <property name="url" value="${LDAP.url}" />
    <property name="userDn" value="${LDAP.user}" />
    <property name="password" value="${LDAP.password}" />
    <property name="pooled" value="${LDAP.pooled}" />
  </bean>

  <bean id="poolingContextSource"
    class="org.springframework.ldap.pool.factory.MutablePoolingContextSource">
    <property name="contextSource" ref="ldapContextSource" />
    <property name="maxActive" value="${max.threads}" />
    <property name="maxTotal" value="${max.threads}" />
    <property name="maxIdle" value="${LDAP.maxIdle}" />
    <property name="minIdle" value="${LDAP.minIdle}" />
    <property name="maxWait" value="${LDAP.maxWait}" />  <!-- <property name="dirContextValidator" ref="dirContextValidator" /> <property 
      name="testOnBorrow" value="${LDAP.testOnBorrow}" /> <property name="testWhileIdle" 
      value="${LDAP.testWhileIdle}" /> -->
  </bean>

	<bean id="ldapTemplate" class="org.springframework.ldap.core.LdapTemplate"><!-- 
		<constructor-arg ref="poolingContextSource" /> -->
		<constructor-arg ref="ldapContextSource" />
		<property name="ignorePartialResultException" value="true" />
		<property name="ignoreNameNotFoundException" value="true" />
	</bean>
  
  <bean id="performanceMonitor" class="com.ibm.lbs.ldap.PerformanceMonitor">
  </bean>

  <bean id="loginModule" class="com.ibm.lbs.ldap.LDAPLoginModule">
    <property name="ldapTemplate" ref="ldapTemplate"></property>
    <property name="performanceMonitor" ref="performanceMonitor"></property>
  </bean>

</beans>