(function(d,c){d.ui.define("slider",{_data:{viewNum:1,imgInit:2,imgZoom:false,loop:false,stopPropagation:false,springBackDis:15,autoPlay:true,autoPlayTime:4000,animationTime:400,showArr:true,showDot:true,slide:null,slideend:null,index:0,_stepLength:1,_direction:1},_create:function(){var a=this,h=0,i,j=[],b=a.data("content");a._initConfig();(a.root()||a.root(d("<div></div>"))).addClass("ui-slider").appendTo(a.data("container")||(a.root().parent().length?"":document.body)).html('<div class="ui-slider-wheel"><div class="ui-slider-group">'+(function(){for(;i=b[h];h++){j.push('<div class="ui-slider-item"><a href="'+i.href+'"><img lazyload="'+i.pic+'"/></a>'+(i.title?"<p>"+i.title+"</p>":"")+"</div>")}j.push(a.data("loop")?'</div><div class="ui-slider-group">'+j.join("")+"</div></div>":"</div></div>");return j.join("")}()));a._addDots()},_setup:function(a){var h=this,j=h.root().addClass("ui-slider");h._initConfig();if(!a){var i=j.children(),b=d('<div class="ui-slider-group"></div>').append(i.addClass("ui-slider-item"));j.empty().append(d('<div class="ui-slider-wheel"></div>').append(b).append(h.data("loop")?b.clone():""));h._addDots()}else{h.data("loop")&&d(".ui-slider-wheel",j).append(d(".ui-slider-group",j).clone())}},_init:function(){var a=this,g=a.data("index"),h=a.root(),b=d.proxy(a._eventHandler,a);a._setWidth();d(a.data("wheel")).on("touchstart touchmove touchend touchcancel webkitTransitionEnd",b);d(window).on("ortchange",b);d(".ui-slider-pre",h).on("tap",function(){a.pre()});d(".ui-slider-next",h).on("tap",function(){a.next()});a.on("destroy",function(){clearTimeout(a.data("play"));d(window).off("ortchange",b)});a.data("autoPlay")&&a._setTimeout()},_initConfig:function(){var a=this._data;if(a.viewNum>1){a.loop=false;a.showDot=false;a.imgInit=a.viewNum+1}},_addDots:function(){var a=this,h=a.root(),b=d(".ui-slider-item",h).length/(a.data("loop")?2:1),g=[];if(a.data("showDot")){g.push('<p class="ui-slider-dots">');while(b--){g.push("<b></b>")}g.push("</p>")}a.data("showArr")&&(g.push('<span class="ui-slider-pre"><b></b></span><span class="ui-slider-next"><b></b></span>'));h.append(g.join(""))},_setWidth:function(){var F=this,y=F._data,E=F.root(),B=Math.ceil(E.width()/y.viewNum),D=E.height(),j=y.loop,b=d(".ui-slider-item",E).toArray(),x=b.length,i=d(".ui-slider-wheel",E).width(B*x)[0],a=d(".ui-slider-dots b",E).toArray(),z=d("img",E).toArray(),C=z.concat(),A={},l,o,w=y.imgInit||x;y.showDot&&(a[0].className="ui-slider-dot-select");if(y.imgZoom){d(C).on("load",function(){var e=this.height,g=this.width,h=Math.min(e,D),f=Math.min(g,B);if(e/D>g/B){this.style.cssText+="height:"+h+"px;width:"+h/e*g+"px;"}else{this.style.cssText+="height:"+f/g*e+"px;width:"+f+"px"}this.onload=null})}for(l=0;l<x;l++){b[l].style.cssText+="width:"+B+"px;position:absolute;-webkit-transform:translate3d("+l*B+"px,0,0);z-index:"+(900-l);A[l]=j?(l>x/2-1?l-x/2:l):l;if(l<w){o=C.shift();o&&(o.src=o.getAttribute("lazyload"));if(y.loop){o=z[l+x/2];o&&(o.src=o.getAttribute("lazyload"))}}}F.data({root:E[0],wheel:i,items:b,lazyImgs:C,allImgs:z,length:x,width:B,height:D,dots:a,dotIndex:A,dot:a[0]});return F},_eventHandler:function(a){var b=this;switch(a.type){case"touchmove":b._touchMove(a);break;case"touchstart":b._touchStart(a);break;case"touchcancel":case"touchend":b._touchEnd();break;case"webkitTransitionEnd":b._transitionEnd();break;case"ortchange":b._resize.call(b);break}},_touchStart:function(a){var b=this;b.data({pageX:a.touches[0].pageX,pageY:a.touches[0].pageY,S:false,T:false,X:0});b.data("wheel").style.webkitTransitionDuration="0ms"},_touchMove:function(e){var b=this._data,a=b.X=e.touches[0].pageX-b.pageX;if(!b.T){var l=b.index,j=b.length,k=Math.abs(a)<Math.abs(e.touches[0].pageY-b.pageY);b.loop&&(b.index=l>0&&(l<j-1)?l:(l===j-1)&&a<0?j/2-1:l===0&&a>0?j/2:l);k||clearTimeout(b.play);b.T=true;b.S=k}if(!b.S){b.stopPropagation&&e.stopPropagation();e.preventDefault();b.wheel.style.webkitTransform="translate3d("+(a-b.index*b.width)+"px,0,0)"}},_touchEnd:function(){var g=this,b=g._data;if(!b.S){var a=b.springBackDis,h=b.X<=-a?Math.ceil(-b.X/b.width):(b.X>a)?-Math.ceil(b.X/b.width):0;b._stepLength=Math.abs(h);g._slide(b.index+h)}},_slide:function(k,a){var i=this,b=i._data,j=b.length,l=j-b.viewNum+1;if(-1<k&&k<l){i._move(k)}else{if(k>=l){if(!b.loop){i._move(l-(a?2:1));b._direction=-1}else{b.wheel.style.cssText+="-webkit-transition:0ms;-webkit-transform:translate3d(-"+(j/2-1)*b.width+"px,0,0);";b._direction=1;d.later(function(){i._move(j/2)},20)}}else{if(!b.loop){i._move(a?1:0)}else{b.wheel.style.cssText+="-webkit-transition:0ms;-webkit-transform:translate3d(-"+(j/2)*b.width+"px,0,0);";d.later(function(){i._move(j/2-1)},20)}b._direction=1}}return i},_move:function(g){var a=this._data,b=a.dotIndex[g];this.trigger("slide",b);if(a.lazyImgs.length){var h=a.allImgs[g];h&&h.src||(h.src=h.getAttribute("lazyload"))}if(a.showDot){a.dot.className="";a.dots[b].className="ui-slider-dot-select";a.dot=a.dots[b]}a.index=g;a.wheel.style.cssText+="-webkit-transition:"+a.animationTime+"ms;-webkit-transform:translate3d(-"+g*a.width+"px,0,0);"},_transitionEnd:function(){var b=this,a=b._data;b.trigger("slideend",a.dotIndex[a.index]);if(a.lazyImgs.length){for(var h=a._stepLength,i=0;i<h;i++){var j=a.lazyImgs.shift();j&&(j.src=j.getAttribute("lazyload"));if(a.loop){j=a.allImgs[a.index+a.length/2];j&&!j.src&&(j.src=j.getAttribute("lazyload"))}}a._stepLength=1}b._setTimeout()},_setTimeout:function(){var b=this,a=b._data;if(!a.autoPlay){return b}clearTimeout(a.play);a.play=d.later(function(){b._slide.call(b,a.index+a._direction,true)},a.autoPlayTime);return b},_resize:function(){var b=this,a=b._data,j=a.root.offsetWidth/a.viewNum,i=a.length,l=a.items;if(!j){return b}a.width=j;clearTimeout(a.play);for(var k=0;k<i;k++){l[k].style.cssText+="width:"+j+"px;-webkit-transform:translate3d("+k*j+"px,0,0);"}a.wheel.style.removeProperty("-webkit-transition");a.wheel.style.cssText+="width:"+j*i+"px;-webkit-transform:translate3d(-"+a.index*j+"px,0,0);";a._direction=1;b._setTimeout();return b},pre:function(){var a=this;a._slide(a.data("index")-1);return a},next:function(){var a=this;a._slide(a.data("index")+1);return a},stop:function(){var a=this;clearTimeout(a.data("play"));a.data("autoPlay",false);return a},resume:function(){var a=this;a.data("_direction",1);a.data("autoPlay",true);a._setTimeout();return a}})})(Zepto);